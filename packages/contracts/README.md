# ZKSign Smart Contracts

Solidity smart contracts for on-chain ZK proof verification.

## Contracts

### CredentialRegistry
Central registry for:
- Authorized issuers
- Credential schemas
- Issued credentials with Poseidon commitments
- Revocation status

### Verifier Contracts
Four specialized verifier contracts for each credential type:

1. **CollegeIDVerifier** - Verifies College ID proofs
2. **CitizenshipCardVerifier** - Verifies Citizenship Card proofs
3. **DriversLicenseVerifier** - Verifies Driver's License proofs
4. **VehicleRegistrationVerifier** - Verifies Vehicle Registration proofs

Each verifier:
- Calls CredentialRegistry to check revocation status
- Verifies ZK proofs on-chain
- Validates predicate results
- Emits verification events

## Setup

```bash
# Install dependencies
pnpm install

# Compile contracts
pnpm compile

# Run tests
pnpm test

# Start local hardhat node
pnpm node

# Deploy to local network
pnpm deploy:local

# Deploy to Sepolia testnet
pnpm deploy:sepolia
```

## Deployment

1. Copy `.env.example` to `.env` and fill in your values
2. Deploy contracts:

```bash
pnpm deploy:local  # Local Hardhat network
pnpm deploy:sepolia  # Sepolia testnet
```

Deployed addresses will be saved to `deployed-addresses.json`.

## On-Chain Verification Flow

1. Issuer registers credential in `CredentialRegistry`
2. Holder generates ZK proof off-chain
3. Verifier calls appropriate verifier contract:
   ```solidity
   bool valid = collegeIDVerifier.verifyCollegeID(
     proof,
     publicInputs,
     credentialId,
     disclosedFieldsBitmap
   );
   ```
4. Verifier contract:
   - Checks credential not revoked
   - Verifies commitment matches
   - Validates ZK proof
   - Returns verification result
5. Transaction receipt serves as proof of verification

## Integration with Noir

In production, verifier contracts would import Noir-generated Solidity verifiers:

```solidity
import "./verifiers/CollegeIDUltraVerifier.sol";

function _verifyProof(bytes calldata proof, uint256[] calldata publicInputs) 
    internal 
    returns (bool) 
{
    return CollegeIDUltraVerifier.verify(proof, publicInputs);
}
```

These are generated by compiling Noir circuits with:
```bash
nargo codegen-verifier
```

## Gas Optimization

Contracts are optimized for gas efficiency:
- Use of `calldata` over `memory`
- Minimal storage writes
- Efficient bitmap operations
- Read-only view functions for gas-free checks

